name: Deploy Static Files

on:
  push:
    branches: [main]
    paths:
      - 'static/**'
  workflow_dispatch:

jobs:
  deploy-production:
    name: Deploy to Production (31.65)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Deploy to 31.65
        uses: appleboy/scp-action@master
        with:
          host: 192.168.31.65
          username: deploy
          key: ${{ secrets.SSH_KEY_PRODUCTION }}
          source: "static/"
          target: "/data/memoryx/"
          strip_components: 0
      
      - name: Restart Nginx
        uses: appleboy/ssh-action@master
        with:
          host: 192.168.31.65
          username: deploy
          key: ${{ secrets.SSH_KEY_PRODUCTION }}
          script: |
            sudo nginx -t && sudo systemctl reload nginx
            echo "✅ Production static files deployed"

  deploy-test:
    name: Deploy to Test (31.66)
    runs-on: ubuntu-latest
    needs: deploy-production
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Deploy to 31.66
        uses: appleboy/scp-action@master
        with:
          host: 192.168.31.66
          username: deploy
          key: ${{ secrets.SSH_KEY_TEST }}
          source: "static/"
          target: "/data/memoryx/"
          strip_components: 0
      
      - name: Restart Nginx
        uses: appleboy/ssh-action@master
        with:
          host: 192.168.31.66
          username: deploy
          key: ${{ secrets.SSH_KEY_TEST }}
          script: |
            sudo nginx -t && sudo systemctl reload nginx
            echo "✅ Test static files deployed"
