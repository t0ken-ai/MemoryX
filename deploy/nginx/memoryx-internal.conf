# 内网 Nginx 配置 (192.168.31.65 或 31.66)
# 说明：
# - 只监听 80 端口，无需 SSL（SSL 在公网 nginx 终止）
# - 无需防火墙（内网环境）
# - 无需限制 IP（访问控制在外层 nginx 处理）

server {
    listen 80;
    server_name _;  # 接受所有主机名

    # 日志
    access_log /var/log/nginx/memoryx-access.log;
    error_log /var/log/nginx/memoryx-error.log;

    # Gzip 压缩
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;

    # ==================== 官网首页 ====================
    location = / {
        root /data/memoryx/static;
        try_files /index.html =404;
    }

    # 隐私政策
    location = /privacy.html {
        root /data/memoryx/static;
        try_files /privacy.html =404;
    }

    # ==================== Portal SPA ====================
    location /portal {
        alias /data/memoryx/static/portal;
        try_files $uri $uri/ /index.html;
        index index.html;
        
        # 缓存静态资源
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 30d;
            add_header Cache-Control "public, immutable";
        }
    }

    # ==================== 静态资源 ====================
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        root /data/memoryx/static;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # ==================== 健康检查 ====================
    location /nginx-health {
        access_log off;
        return 200 "nginx ok\n";
        add_header Content-Type text/plain;
    }

    # ==================== 禁止访问的文件 ====================
    location ~ /\. {
        deny all;
        return 404;
    }
}

# 注意：
# 1. 不需要 ssl 配置（SSL 在公网 nginx 终止）
# 2. 不需要防火墙规则（内网环境，访问控制在外层）
# 3. 不需要 IP 限制（限制在公网 nginx 处理）
